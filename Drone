import cv2
from djitellopy import Tello
from time import sleep
import keyboard
# Initialize and connect drone
drone = Tello()
drone.connect()
print("Battery:", drone.get_battery())

# Start camera stream
drone.streamon()

# Optional: show the window larger
cv2.namedWindow("Tello Camera", cv2.WINDOW_NORMAL)

# Takeoff
drone.takeoff()
sleep(2)

# Main loop
try:
    while True:
        # Show live camera
        frame = drone.get_frame_read().frame
        img = cv2.resize(frame, (640, 480))
        cv2.imshow("Tello Camera", img)
        cv2.waitKey(1)

        # Controls
        if keyboard.is_pressed("w"):
            drone.move_forward(30)
        elif keyboard.is_pressed("s"):
            drone.move_back(30)
        elif keyboard.is_pressed("a"):
            drone.move_left(30)
        elif keyboard.is_pressed("d"):
            drone.move_right(30)
        elif keyboard.is_pressed("r"):
            drone.move_up(30)
        elif keyboard.is_pressed("f"):
            drone.move_down(30)
        elif keyboard.is_pressed("e"):
            drone.rotate_clockwise(30)
        elif keyboard.is_pressed("q"):
            drone.rotate_counter_clockwise(30)
        elif keyboard.is_pressed("c"):
            drone.flip("b")
        elif keyboard.is_pressed("l"):
            print("Landing...")
            break

        sleep(0.1)

except Exception as e:
    print("Error:", e)

# LAND AND SHUT DOWN
drone.land()
drone.streamoff()
cv2.destroyAllWindows()
drone.end()
